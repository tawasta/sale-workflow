<?xml version="1.0" ?>
<odoo>
    <record id="view_blanket_order_form" model="ir.ui.view">
        <field name="name">sale.blanket.order.forecast.form</field>
        <field name="model">sale.blanket.order</field>
        <field eval="100" name="priority" />
        <field name="inherit_id" ref="sale_blanket_order.view_blanket_order_form" />
        <field name="arch" type="xml">

            <button name="set_to_draft" position="after">
                <button
                    name="action_create_forecast"
                    string="Compute forecast"
                    class="btn-primary"
                    attrs="{'invisible': ['|',('create_forecast_sales', '=', False),('state', 'not in', ['open','done'])]}"
                    type="object"
                />
            </button>

            <field name="currency_id" position="before">
                <field name="create_forecast_sales" widget="boolean_toggle" />
                <field
                    name="forecast_policy"
                    attrs="{'invisible': [('create_forecast_sales', '=', False)]}"
                />
                <field
                    name="replacement_policy"
                    attrs="{'invisible': [('create_forecast_sales', '=', False)]}"
                />
                <field
                    name="forecast_sale_order_id"
                    attrs="{'invisible': [('create_forecast_sales', '=', False)]}"
                />
            </field>

            <field name="validity_date" position="before">
                <field name="validity_date_start" />
            </field>

            <xpath expr="//field[@name='original_uom_qty']" position="after">
                <field name="create_forecast_sales" invisible="1" />
                <field
                    name="realized_uom_qty"
                    string="Realized Qty"
                    optional="Show"
                    decoration-danger="realized_uom_qty > original_uom_qty"
                />
            </xpath>

            <xpath expr="//field[@name='original_uom_qty']" position="attributes">
                <attribute
                    name="decoration-danger"
                >realized_uom_qty > original_uom_qty</attribute>
            </xpath>

            <!-- Hide unnecessary fields from forecast -->
            <xpath expr="//button[@class='btn-primary']">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//field[@name='product_uom']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//field[@name='price_unit']" position="attributes">
                <attribute name="optional">show</attribute>
            </xpath>

            <xpath expr="//field[@name='date_schedule']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//field[@name='ordered_uom_qty']" position="attributes">
                <attribute name="optional">show</attribute>
            </xpath>

            <xpath expr="//field[@name='invoiced_uom_qty']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//field[@name='delivered_uom_qty']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//field[@name='remaining_uom_qty']" position="attributes">
                <attribute name="optional">show</attribute>
            </xpath>

            <xpath expr="//field[@name='taxes_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath
                expr="//group[@class='oe_subtotal_footer oe_right']"
                position="attributes"
            >
                <attribute
                    name="attrs"
                >{'invisible': [('create_forecast_sales', '=', True)]}</attribute>
            </xpath>

        </field>
    </record>
</odoo>
